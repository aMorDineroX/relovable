# üîß **Guide de D√©pannage BingX - Solutions Compl√®tes**

## üö® **Probl√®mes Courants et Solutions**

### **‚ùå Erreur: "API keys not configured"**

#### **Sympt√¥mes :**
- R√©ponse : `{ "error": "API keys not configured" }`
- Status code : 500

#### **Causes :**
1. Fichier `.env.local` absent ou mal plac√©
2. Variables d'environnement non d√©finies
3. Nom des variables incorrect

#### **Solutions :**

**1. V√©rifier le fichier .env.local**
```bash
# Le fichier doit √™tre dans le dossier racine de l'app
ls -la newapp/bingx-web/.env.local

# V√©rifier le contenu
cat newapp/bingx-web/.env.local
```

**2. Format correct du .env.local**
```env
API_KEY=votre_cle_api_bingx_ici
SECRET_KEY=votre_cle_secrete_bingx_ici
```

**3. Red√©marrer le serveur**
```bash
# Arr√™ter le serveur (Ctrl+C) puis
npm run dev
```

**4. V√©rifier en JavaScript**
```javascript
// Dans la console navigateur
fetch('/api/test-config')
  .then(r => r.json())
  .then(console.log);
```

---

### **‚ùå Erreur: "Signature verification failed"**

#### **Sympt√¥mes :**
- Code BingX : `-1022`
- Message : `"Signature verification failed"`

#### **Causes :**
1. `SECRET_KEY` incorrecte
2. Probl√®me de g√©n√©ration de signature
3. D√©calage d'horloge syst√®me

#### **Solutions :**

**1. V√©rifier la SECRET_KEY**
```javascript
// Test de g√©n√©ration de signature
const crypto = require('crypto');
const testParams = "timestamp=1640995200000";
const signature = crypto.createHmac('sha256', process.env.SECRET_KEY)
  .update(testParams).digest('hex');
console.log('Signature test:', signature);
```

**2. Synchroniser l'heure syst√®me**
```bash
# Linux/Mac
sudo ntpdate -s time.nist.gov

# Windows
w32tm /resync
```

**3. Tester avec timestamp fixe**
```javascript
// Dans votre code de test
const timestamp = 1640995200000; // Timestamp fixe pour test
```

---

### **‚ùå Erreur: "Invalid API-key, IP, or permissions"**

#### **Sympt√¥mes :**
- Code BingX : `-2015`
- Acc√®s refus√©

#### **Solutions :**

**1. V√©rifier les permissions API**
Dans votre compte BingX :
- ‚úÖ **Enable Reading** : OUI
- ‚úÖ **Enable Futures** : OUI  
- ‚ùå **Enable Withdrawals** : NON (s√©curit√©)

**2. V√©rifier la restriction IP**
```bash
# R√©cup√©rer votre IP publique
curl ifconfig.me

# Si vous utilisez des restrictions IP, ajoutez cette IP dans BingX
```

**3. R√©g√©n√©rer les cl√©s API**
- Allez dans BingX > API Management
- Supprimez l'ancienne cl√©
- Cr√©ez une nouvelle paire API/SECRET
- Mettez √† jour votre `.env.local`

---

### **‚ùå Probl√®me: Donn√©es vides ou compte vide**

#### **Sympt√¥mes :**
```json
{
  "code": 0,
  "msg": "Success",
  "data": []
}
```

#### **C'est Normal Si :**
1. Votre compte BingX n'a pas de fonds
2. Vous n'avez pas de positions ouvertes
3. Vous regardez le mauvais type de compte

#### **Solutions :**

**1. V√©rifier le solde de compte**
```javascript
// V√©rifier les deux types de comptes
Promise.all([
  fetch('/api/balance').then(r => r.json()),
  fetch('/api/standard-futures/balance').then(r => r.json())
]).then(([perpetual, standard]) => {
  console.log('Perpetual:', perpetual.data);
  console.log('Standard:', standard.data);
});
```

**2. Financer le compte**
- Connectez-vous √† BingX
- Transf√©rez des fonds vers "Futures" ou "Perpetual"
- Attendez quelques minutes

**3. Tester avec un ordre simul√©**
```bash
# Cr√©er une position de test tr√®s petite
curl -X POST http://localhost:3000/api/test-order \
  -H "Content-Type: application/json" \
  -d '{"symbol":"BTC-USDT","side":"BUY","quantity":"0.001"}'
```

---

### **‚ùå Erreur: "Timestamp outside recv window"**

#### **Sympt√¥mes :**
- Code BingX : `-1021`
- Probl√®me de synchronisation temporelle

#### **Solutions :**

**1. Utiliser timestamp serveur BingX**
```javascript
// R√©cup√©rer d'abord l'heure serveur
const serverTime = await fetch('/api/server/time')
  .then(r => r.json());

// Utiliser ce timestamp
const timestamp = serverTime.serverTime;
```

**2. Augmenter la fen√™tre de r√©ception**
```javascript
// Ajouter un buffer de temps
const timestamp = Date.now() - 1000; // 1 seconde de buffer
```

---

## üîç **Outils de Debug**

### **1. Script de Diagnostic Complet**

```javascript
// debug-bingx.js
async function diagnoseBingX() {
  console.log('üîç Diagnostic BingX complet...\n');
  
  // 1. V√©rifier configuration
  console.log('1. Configuration:');
  console.log('API_KEY pr√©sente:', !!process.env.API_KEY);
  console.log('SECRET_KEY pr√©sente:', !!process.env.SECRET_KEY);
  console.log('');
  
  // 2. Test connectivit√©
  console.log('2. Test de connectivit√©:');
  try {
    const start = Date.now();
    const response = await fetch('http://localhost:3000/api/server/time');
    const data = await response.json();
    console.log('‚úÖ Serveur accessible:', Date.now() - start, 'ms');
    console.log('Heure serveur:', new Date(data.serverTime));
  } catch (error) {
    console.log('‚ùå Probl√®me serveur:', error.message);
  }
  console.log('');
  
  // 3. Test endpoints
  const endpoints = [
    '/api/balance',
    '/api/positions', 
    '/api/standard-futures/balance',
    '/api/standard-futures/positions'
  ];
  
  console.log('3. Test des endpoints:');
  for (const endpoint of endpoints) {
    try {
      const start = Date.now();
      const response = await fetch(`http://localhost:3000${endpoint}`);
      const data = await response.json();
      const time = Date.now() - start;
      
      if (response.ok && data.code === 0) {
        console.log(`‚úÖ ${endpoint}: ${time}ms - ${Array.isArray(data.data) ? data.data.length : 'OK'} items`);
      } else {
        console.log(`‚ö†Ô∏è ${endpoint}: ${time}ms - ${data.error || data.msg}`);
      }
    } catch (error) {
      console.log(`‚ùå ${endpoint}: ERROR - ${error.message}`);
    }
  }
  
  console.log('\nüéØ Diagnostic termin√©!');
}

// Ex√©cuter
diagnoseBingX();
```

### **2. Monitor en Temps R√©el**

```javascript
// monitor-api.js
class BingXMonitor {
  constructor() {
    this.stats = {
      calls: 0,
      errors: 0,
      avgResponseTime: 0
    };
  }
  
  async monitor() {
    setInterval(async () => {
      const start = Date.now();
      
      try {
        const response = await fetch('/api/balance');
        const data = await response.json();
        const time = Date.now() - start;
        
        this.stats.calls++;
        this.stats.avgResponseTime = 
          (this.stats.avgResponseTime * (this.stats.calls - 1) + time) / this.stats.calls;
        
        if (data.code !== 0) {
          this.stats.errors++;
          console.log(`‚ùå Error ${data.code}: ${data.msg}`);
        } else {
          console.log(`‚úÖ ${time}ms - Balance: ${data.data.balance} ${data.data.asset}`);
        }
        
      } catch (error) {
        this.stats.errors++;
        console.log(`‚ùå Network error: ${error.message}`);
      }
      
      // Afficher stats toutes les 10 calls
      if (this.stats.calls % 10 === 0) {
        console.log(`üìä Stats: ${this.stats.calls} calls, ${this.stats.errors} errors, ${this.stats.avgResponseTime.toFixed(0)}ms avg`);
      }
      
    }, 5000); // Toutes les 5 secondes
  }
}

const monitor = new BingXMonitor();
monitor.monitor();
```

---

## üõ°Ô∏è **S√©curit√© et Bonnes Pratiques**

### **Protection des Cl√©s API**

**‚ùå √Ä ne JAMAIS faire :**
```javascript
// NE JAMAIS faire √ßa !
const API_KEY = "votre_cle_en_dur_dans_le_code"; // DANGER !
```

**‚úÖ Bonnes pratiques :**
```javascript
// Toujours utiliser les variables d'environnement
const API_KEY = process.env.API_KEY;

// V√©rifier la pr√©sence
if (!API_KEY) {
  throw new Error('API_KEY manquante');
}

// Masquer dans les logs
console.log('API Key:', API_KEY.substring(0, 8) + '...');
```

### **Validation des R√©ponses**

```javascript
function validateBingXResponse(data) {
  // V√©rifier la structure de base
  if (typeof data !== 'object' || data === null) {
    throw new Error('R√©ponse invalide: pas un objet');
  }
  
  // V√©rifier le code de succ√®s
  if (data.code !== 0) {
    throw new Error(`Erreur BingX ${data.code}: ${data.msg || 'Inconnue'}`);
  }
  
  // V√©rifier la pr√©sence des donn√©es
  if (!data.hasOwnProperty('data')) {
    throw new Error('R√©ponse invalide: propri√©t√© data manquante');
  }
  
  return data.data;
}

// Usage
try {
  const response = await fetch('/api/balance');
  const data = await response.json();
  const balance = validateBingXResponse(data);
  console.log('Balance valid√©e:', balance);
} catch (error) {
  console.error('Erreur validation:', error.message);
}
```

---

## üìû **Support et Ressources**

### **Logs Utiles**

```bash
# Logs du serveur Next.js
npm run dev | tee bingx-logs.txt

# Logs des erreurs uniquement
npm run dev 2>&1 | grep -i error

# Logs des calls API
npm run dev 2>&1 | grep -i "bingx\|api"
```

### **Commandes de Diagnostic**

```bash
# V√©rifier la configuration
echo "API_KEY: ${API_KEY:0:8}..."
echo "SECRET_KEY: ${SECRET_KEY:0:8}..."

# Test de connectivit√© r√©seau
ping -c 3 open-api.bingx.com

# Test des ports locaux
netstat -tulpn | grep :3000
```

### **Checklist de V√©rification**

**Avant de demander de l'aide :**

- [ ] Fichier `.env.local` pr√©sent et correct
- [ ] Cl√©s API valides sur BingX
- [ ] Permissions API activ√©es (Reading + Futures)
- [ ] Serveur de d√©veloppement d√©marr√© (`npm run dev`)
- [ ] Aucune restriction IP probl√©matique
- [ ] Heure syst√®me synchronis√©e
- [ ] Fonds pr√©sents sur le compte BingX
- [ ] Tests basiques passent (`curl /api/balance`)

---

## üÜò **En Cas de Probl√®me Persistant**

### **1. Reset Complet**

```bash
# Arr√™ter le serveur
# Ctrl+C

# Nettoyer le cache
rm -rf .next
rm -rf node_modules

# R√©installer
npm install

# Red√©marrer
npm run dev
```

### **2. Mode Debug Avanc√©**

```javascript
// Ajouter dans votre .env.local
DEBUG=true
BINGX_LOG_LEVEL=verbose

// Activer logs d√©taill√©s
export NODE_ENV=development
```

### **3. Test Environnement Minimal**

```javascript
// test-minimal.js
const crypto = require('crypto');

// Test signature basique
const testData = "timestamp=1640995200000";
const signature = crypto.createHmac('sha256', 'test_secret')
  .update(testData).digest('hex');

console.log('Test signature:', signature);

// Test fetch basique
fetch('https://open-api.bingx.com/openApi/swap/v2/quote/ticker')
  .then(r => r.json())
  .then(console.log)
  .catch(console.error);
```

---

**üéØ La plupart des probl√®mes sont r√©solus en suivant ce guide !**

**Si votre probl√®me persiste :** Consultez les logs complets et utilisez les outils de diagnostic fournis. üõ†Ô∏è